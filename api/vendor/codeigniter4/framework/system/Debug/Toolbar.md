


 



<table>
<tr>
<td style="width:100%"><em>framework/system/Debug/Toolbar.php</em></td>
<td><a href="../../../../../../api/index.md">index</a></td>
<td><a href="../../../../../../api/vendor/codeigniter4/framework/system/Debug/Timer.md">prev</a></td>
<td><a href="../../../../../../api/vendor/codeigniter4/framework/system/Debug/Toolbar/Collectors/BaseCollector.md">next</a></td>
</tr>
</table>







# CodeIgniter\Debug 
<table style="text-align:left">
<tr><th>namespace</th><td>CodeIgniter\Debug</td></tr>
</table>

<details>
<summary style="margin-bottom:12px;"><strong>Description</strong></summary>

<table>
<tr><td>
CodeIgniter
</td></tr>
</table>

<table>
<tr><td>
An open source application development framework for PHP

This content is released under the MIT License (MIT)

Copyright (c) 2014-2019 British Columbia Institute of Technology
Copyright (c) 2019-2020 CodeIgniter Foundation

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in
all copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
THE SOFTWARE.
</td></tr>
</table>

</details>



<table style="text-align:left">
<tr style="vertical-align:top;">
<th>package</th>
<td>CodeIgniter
</td>
</tr>
<tr style="vertical-align:top;">
<th>author</th>
<td>CodeIgniter Dev Team
</td>
</tr>
<tr style="vertical-align:top;">
<th>copyright</th>
<td>2019-2020 CodeIgniter Foundation
</td>
</tr>
<tr style="vertical-align:top;">
<th>license</th>
<td><a href="https://opensource.org/licenses/MIT">https://opensource.org/licenses/MIT</a>	MIT License
</td>
</tr>
<tr style="vertical-align:top;">
<th>link</th>
<td><a href="https://codeigniter.com">https://codeigniter.com</a>

</td>
</tr>
<tr style="vertical-align:top;">
<th>filesource</th>
<td>framework/system/Debug/Toolbar.php
</td>
</tr>
</table>

 

<details>
<summary style="margin-bottom:12px;"><strong>Members</strong></summary>
<table>
<tr><td><a href="../../../../../../api/vendor/codeigniter4/framework/system/Debug/Exceptions.md">CodeIgniter\Debug\Exceptions</a></td></tr>
<tr><td><a href="../../../../../../api/vendor/codeigniter4/framework/system/Debug/Iterator.md">CodeIgniter\Debug\Iterator</a></td></tr>
<tr><td><a href="../../../../../../api/vendor/codeigniter4/framework/system/Debug/Timer.md">CodeIgniter\Debug\Timer</a></td></tr>
<tr><td><a href="../../../../../../api/vendor/codeigniter4/framework/system/Debug/Toolbar.md">CodeIgniter\Debug\Toolbar</a></td></tr>
<tr><td><a href="../../../../../../api/vendor/codeigniter4/framework/system/Debug/Toolbar/Collectors/BaseCollector.md">CodeIgniter\Debug\Toolbar\Collectors\BaseCollector</a></td></tr>
<tr><td><a href="../../../../../../api/vendor/codeigniter4/framework/system/Debug/Toolbar/Collectors/Config.md">CodeIgniter\Debug\Toolbar\Collectors\Config</a></td></tr>
<tr><td><a href="../../../../../../api/vendor/codeigniter4/framework/system/Debug/Toolbar/Collectors/Database.md">CodeIgniter\Debug\Toolbar\Collectors\Database</a></td></tr>
<tr><td><a href="../../../../../../api/vendor/codeigniter4/framework/system/Debug/Toolbar/Collectors/Events.md">CodeIgniter\Debug\Toolbar\Collectors\Events</a></td></tr>
<tr><td><a href="../../../../../../api/vendor/codeigniter4/framework/system/Debug/Toolbar/Collectors/Files.md">CodeIgniter\Debug\Toolbar\Collectors\Files</a></td></tr>
<tr><td><a href="../../../../../../api/vendor/codeigniter4/framework/system/Debug/Toolbar/Collectors/History.md">CodeIgniter\Debug\Toolbar\Collectors\History</a></td></tr>
<tr><td><a href="../../../../../../api/vendor/codeigniter4/framework/system/Debug/Toolbar/Collectors/Logs.md">CodeIgniter\Debug\Toolbar\Collectors\Logs</a></td></tr>
<tr><td><a href="../../../../../../api/vendor/codeigniter4/framework/system/Debug/Toolbar/Collectors/Routes.md">CodeIgniter\Debug\Toolbar\Collectors\Routes</a></td></tr>
<tr><td><a href="../../../../../../api/vendor/codeigniter4/framework/system/Debug/Toolbar/Collectors/Timers.md">CodeIgniter\Debug\Toolbar\Collectors\Timers</a></td></tr>
<tr><td><a href="../../../../../../api/vendor/codeigniter4/framework/system/Debug/Toolbar/Collectors/Views.md">CodeIgniter\Debug\Toolbar\Collectors\Views</a></td></tr>
</table>
</details>



 
 ## Uses

<table style="text-align:left;">
<tr>
<td>
<a href="../../../../../../api/vendor/codeigniter4/framework/system/Config/BaseConfig.md"><strong>CodeIgniter\Config\BaseConfig</strong></a>
</td>
<td>BaseConfig</td>
</tr>
<tr>
<td>
<a href="../../../../../../api/vendor/codeigniter4/framework/system/Debug/Toolbar/Collectors/History.md"><strong>CodeIgniter\Debug\Toolbar\Collectors\History</strong></a>
</td>
<td>History</td>
</tr>
<tr>
<td>
<a href="../../../../../../api/vendor/codeigniter4/framework/system/Format/JSONFormatter.md"><strong>CodeIgniter\Format\JSONFormatter</strong></a>
</td>
<td>JSONFormatter</td>
</tr>
<tr>
<td>
<a href="../../../../../../api/vendor/codeigniter4/framework/system/Format/XMLFormatter.md"><strong>CodeIgniter\Format\XMLFormatter</strong></a>
</td>
<td>XMLFormatter</td>
</tr>
<tr>
<td>
<a href="../../../../../../api/vendor/codeigniter4/framework/system/HTTP/DownloadResponse.md"><strong>CodeIgniter\HTTP\DownloadResponse</strong></a>
</td>
<td>DownloadResponse</td>
</tr>
<tr>
<td>
<a href="../../../../../../api/vendor/codeigniter4/framework/system/HTTP/RequestInterface.md"><strong>CodeIgniter\HTTP\RequestInterface</strong></a>
</td>
<td>RequestInterface</td>
</tr>
<tr>
<td>
<a href="../../../../../../api/vendor/codeigniter4/framework/system/HTTP/ResponseInterface.md"><strong>CodeIgniter\HTTP\ResponseInterface</strong></a>
</td>
<td>ResponseInterface</td>
</tr>
<tr>
<td>
<strong>Config\Services</strong>
</td>
<td>Services</td>
</tr>
</table>



 
## CodeIgniter\Debug\Toolbar

<table style="text-align:left">
<tr><th>Class</th><td>Toolbar</td></tr>
<tr><th>Fully Qualified Name</th><td>CodeIgniter\Debug\Toolbar</td></tr>
</table>


<details>
<summary style="margin-bottom:12px;"><strong>Description</strong></summary>

<table>
<tr><td>
Debug Toolbar
</td></tr>
</table>

<table>
<tr><td>
Displays a toolbar with bits of stats to aid a developer in debugging.

Inspiration: <a href="http://prophiler.fabfuel.de">http://prophiler.fabfuel.de</a>
</td></tr>
</table>

</details>



<table style="text-align:left">
<tr style="vertical-align:top;">
<th>package</th>
<td>CodeIgniter\Debug
</td>
</tr>
</table>



### Summary


<table style="text-align:left;">
<tr>
<th>Name</th>
<th>Element</th>
<th>Modifier</th>
<th>Description</th>
</tr>

<tr>
<th><a href="#config"><strong>config</strong></a></th>
<td>prop</td>
<td>
protected

</td>
<td>Toolbar configuration settings.</td>
</tr>
<tr>
<th><a href="#collectors"><strong>collectors</strong></a></th>
<td>prop</td>
<td>
protected

</td>
<td>Collectors to be used and displayed.</td>
</tr>

<tr>
<th><a href="#__construct"><strong>__construct</strong>()</a></th>
<td>method</td>
<td>
public

</td>
<td>Constructor</td>
</tr>
<tr>
<th><a href="#run"><strong>run</strong>()</a></th>
<td>method</td>
<td>
public

</td>
<td>Returns all the data required by Debug Bar</td>
</tr>
<tr>
<th><a href="#renderTimeline"><strong>renderTimeline</strong>()</a></th>
<td>method</td>
<td>
protected

</td>
<td>Called within the view to display the timeline itself.</td>
</tr>
<tr>
<th><a href="#collectTimelineData"><strong>collectTimelineData</strong>()</a></th>
<td>method</td>
<td>
protected

</td>
<td>Returns a sorted array of timeline data arrays from the collectors.</td>
</tr>
<tr>
<th><a href="#collectVarData"><strong>collectVarData</strong>()</a></th>
<td>method</td>
<td>
protected

</td>
<td>Returns an array of data from all of the modules
that should be displayed in the &#039;Vars&#039; tab.</td>
</tr>
<tr>
<th><a href="#roundTo"><strong>roundTo</strong>()</a></th>
<td>method</td>
<td>
protected

</td>
<td>Rounds a number to the nearest incremental value.</td>
</tr>
<tr>
<th><a href="#prepare"><strong>prepare</strong>()</a></th>
<td>method</td>
<td>
public

</td>
<td>Prepare for debugging.</td>
</tr>
<tr>
<th><a href="#respond"><strong>respond</strong>()</a></th>
<td>method</td>
<td>
public

</td>
<td>Inject debug toolbar into the response.</td>
</tr>
<tr>
<th><a href="#format"><strong>format</strong>()</a></th>
<td>method</td>
<td>
protected

</td>
<td>Format output</td>
</tr>

</table>





### Properties


<hr>

#### $config

```php
protected $config;
```

<details>
<summary style="margin-bottom:12px;"><strong>Description</strong></summary>

<table>
<tr><td>
Toolbar configuration settings.
</td></tr>
</table>


</details>



<table style="text-align:left">
</table>




<table>
<tr>
<th style="vertical-align:top;">var</th>
<td>\BaseConfig
</td>
</tr>
</table>


<hr>

#### $collectors

```php
protected $collectors = [];
```

<details>
<summary style="margin-bottom:12px;"><strong>Description</strong></summary>

<table>
<tr><td>
Collectors to be used and displayed.
</td></tr>
</table>


</details>



<table style="text-align:left">
</table>




<table>
<tr>
<th style="vertical-align:top;">var</th>
<td>\CodeIgniter\Debug\Toolbar\Collectors\BaseCollector[]
</td>
</tr>
</table>







### Methods


<hr>

#### __construct()

```php
public function __construct(BaseConfig $config)
```

<details>
<summary style="margin-bottom:12px;"><strong>Description</strong></summary>

<table>
<tr><td>
Constructor
</td></tr>
</table>


</details>



<table style="text-align:left">
</table>


**Params**

<table>
<thead>
<tr>
<th>#</th>
<th>Variable</th>
<th>Type</th>
<th>Variadic</th>
<th>Description</th>
</tr>
</thead>
<tbody>

<tr>
<td>1.</td>
<td><code>$config</code></td>
<td><em>\BaseConfig
</em></td>
<td>false</td>
<td></td>
</tr>


</tbody>
</table>








<details>
<summary><small>Source: 16 lines (83 - 98)</small></summary>

```php
public function __construct(BaseConfig $config)
{
	$this->config = $config;

	foreach ($config->collectors as $collector)
	{
		if (! class_exists($collector))
		{
			log_message('critical', 'Toolbar collector does not exists(' . $collector . ').' .
					'please check $collectors in the Config\Toolbar.php file.');
			continue;
		}

		$this->collectors[] = new $collector();
	}
}
```

</details>


<hr>

#### run()

```php
public function run(float $startTime, float $totalTime, RequestInterface $request, ResponseInterface $response) : string
```

<details>
<summary style="margin-bottom:12px;"><strong>Description</strong></summary>

<table>
<tr><td>
Returns all the data required by Debug Bar
</td></tr>
</table>


</details>



<table style="text-align:left">
</table>


**Params**

<table>
<thead>
<tr>
<th>#</th>
<th>Variable</th>
<th>Type</th>
<th>Variadic</th>
<th>Description</th>
</tr>
</thead>
<tbody>

<tr>
<td>1.</td>
<td><code>$startTime</code></td>
<td><em>float
</em></td>
<td>false</td>
<td>App start time</td>
</tr>

<tr>
<td>2.</td>
<td><code>$totalTime</code></td>
<td><em>float
</em></td>
<td>false</td>
<td></td>
</tr>

<tr>
<td>3.</td>
<td><code>$request</code></td>
<td><em>\CodeIgniter\HTTP\RequestInterface
</em></td>
<td>false</td>
<td></td>
</tr>

<tr>
<td>4.</td>
<td><code>$response</code></td>
<td><em>\CodeIgniter\HTTP\ResponseInterface
</em></td>
<td>false</td>
<td></td>
</tr>


</tbody>
</table>



<table>
<tr>
<th style="vertical-align:top;">return</th>
<td>string
</td>
</tr>
</table>





<details>
<summary><small>Source: 98 lines (112 - 209)</small></summary>

```php
public function run(float $startTime, float $totalTime, RequestInterface $request, ResponseInterface $response): string
{
	// Data items used within the view.
	$data['url']             = current_url();
	$data['method']          = $request->getMethod(true);
	$data['isAJAX']          = $request->isAJAX();
	$data['startTime']       = $startTime;
	$data['totalTime']       = $totalTime * 1000;
	$data['totalMemory']     = number_format((memory_get_peak_usage()) / 1024 / 1024, 3);
	$data['segmentDuration'] = $this->roundTo($data['totalTime'] / 7);
	$data['segmentCount']    = (int) ceil($data['totalTime'] / $data['segmentDuration']);
	$data['CI_VERSION']      = \CodeIgniter\CodeIgniter::CI_VERSION;
	$data['collectors']      = [];

	foreach ($this->collectors as $collector)
	{
		$data['collectors'][] = $collector->getAsArray();
	}

	foreach ($this->collectVarData() as $heading => $items)
	{
		$varData = [];

		if (is_array($items))
		{
			foreach ($items as $key => $value)
			{
				$varData[esc($key)] = is_string($value) ? esc($value) : '<pre>' . esc(print_r($value, true)) . '</pre>';
			}
		}

		$data['vars']['varData'][esc($heading)] = $varData;
	}

	if (! empty($_SESSION))
	{
		foreach ($_SESSION as $key => $value)
		{
			// Replace the binary data with string to avoid json_encode failure.
			if (is_string($value) && preg_match('~[^\x20-\x7E\t\r\n]~', $value))
			{
				$value = 'binary data';
			}

			$data['vars']['session'][esc($key)] = is_string($value) ? esc($value) : '<pre>' . esc(print_r($value, true)) . '</pre>';
		}
	}

	foreach ($request->getGet() as $name => $value)
	{
		$data['vars']['get'][esc($name)] = is_array($value) ? '<pre>' . esc(print_r($value, true)) . '</pre>' : esc($value);
	}

	foreach ($request->getPost() as $name => $value)
	{
		$data['vars']['post'][esc($name)] = is_array($value) ? '<pre>' . esc(print_r($value, true)) . '</pre>' : esc($value);
	}

	foreach ($request->getHeaders() as $value)
	{
		if (empty($value))
		{
			continue;
		}

		if (! is_array($value))
		{
			$value = [$value];
		}

		foreach ($value as $h)
		{
			$data['vars']['headers'][esc($h->getName())] = esc($h->getValueLine());
		}
	}

	foreach ($request->getCookie() as $name => $value)
	{
		$data['vars']['cookies'][esc($name)] = esc($value);
	}

	$data['vars']['request'] = ($request->isSecure() ? 'HTTPS' : 'HTTP') . '/' . $request->getProtocolVersion();

	$data['vars']['response'] = [
		'statusCode'  => $response->getStatusCode(),
		'reason'      => esc($response->getReason()),
		'contentType' => esc($response->getHeaderLine('content-type')),
	];

	$data['config'] = \CodeIgniter\Debug\Toolbar\Collectors\Config::display();

	if ($response->CSP !== null)
	{
		$response->CSP->addImageSrc('data:');
	}

	return json_encode($data);
}
```

</details>


<hr>

#### renderTimeline()

```php
protected function renderTimeline(array $collectors, float $startTime, int $segmentCount, int $segmentDuration, array &$styles) : string
```

<details>
<summary style="margin-bottom:12px;"><strong>Description</strong></summary>

<table>
<tr><td>
Called within the view to display the timeline itself.
</td></tr>
</table>


</details>



<table style="text-align:left">
</table>


**Params**

<table>
<thead>
<tr>
<th>#</th>
<th>Variable</th>
<th>Type</th>
<th>Variadic</th>
<th>Description</th>
</tr>
</thead>
<tbody>

<tr>
<td>1.</td>
<td><code>$collectors</code></td>
<td><em>array
</em></td>
<td>false</td>
<td></td>
</tr>

<tr>
<td>2.</td>
<td><code>$startTime</code></td>
<td><em>float
</em></td>
<td>false</td>
<td></td>
</tr>

<tr>
<td>3.</td>
<td><code>$segmentCount</code></td>
<td><em>int
</em></td>
<td>false</td>
<td></td>
</tr>

<tr>
<td>4.</td>
<td><code>$segmentDuration</code></td>
<td><em>int
</em></td>
<td>false</td>
<td></td>
</tr>

<tr>
<td>5.</td>
<td><code>$styles</code></td>
<td><em>array
</em></td>
<td>false</td>
<td></td>
</tr>


</tbody>
</table>



<table>
<tr>
<th style="vertical-align:top;">return</th>
<td>string
</td>
</tr>
</table>





<details>
<summary><small>Source: 28 lines (225 - 252)</small></summary>

```php
protected function renderTimeline(array $collectors, float $startTime, int $segmentCount, int $segmentDuration, array &$styles): string
{
	$displayTime = $segmentCount * $segmentDuration;
	$rows        = $this->collectTimelineData($collectors);
	$output      = '';
	$styleCount  = 0;

	foreach ($rows as $row)
	{
		$output .= '<tr>';
		$output .= "<td>{$row['name']}</td>";
		$output .= "<td>{$row['component']}</td>";
		$output .= "<td class='debug-bar-alignRight'>" . number_format($row['duration'] * 1000, 2) . ' ms</td>';
		$output .= "<td class='debug-bar-noverflow' colspan='{$segmentCount}'>";

		$offset = ((((float) $row['start'] - $startTime) * 1000) / $displayTime) * 100;
		$length = (((float) $row['duration'] * 1000) / $displayTime) * 100;

		$styles['debug-bar-timeline-' . $styleCount] = "left: {$offset}%; width: {$length}%;";
		$output                                     .= "<span class='timer debug-bar-timeline-{$styleCount}' title='" . number_format($length, 2) . "%'></span>";
		$output                                     .= '</td>';
		$output                                     .= '</tr>';

		$styleCount ++;
	}

	return $output;
}
```

</details>


<hr>

#### collectTimelineData()

```php
protected function collectTimelineData($collectors) : array
```

<details>
<summary style="margin-bottom:12px;"><strong>Description</strong></summary>

<table>
<tr><td>
Returns a sorted array of timeline data arrays from the collectors.
</td></tr>
</table>


</details>



<table style="text-align:left">
</table>


**Params**

<table>
<thead>
<tr>
<th>#</th>
<th>Variable</th>
<th>Type</th>
<th>Variadic</th>
<th>Description</th>
</tr>
</thead>
<tbody>

<tr>
<td>1.</td>
<td><code>$collectors</code></td>
<td><em>array
</em></td>
<td>false</td>
<td></td>
</tr>


</tbody>
</table>



<table>
<tr>
<th style="vertical-align:top;">return</th>
<td>array
</td>
</tr>
</table>





<details>
<summary><small>Source: 19 lines (263 - 281)</small></summary>

```php
protected function collectTimelineData($collectors): array
{
	$data = [];

	// Collect it
	foreach ($collectors as $collector)
	{
		if (! $collector['hasTimelineData'])
		{
			continue;
		}

		$data = array_merge($data, $collector['timelineData']);
	}

	// Sort it

	return $data;
}
```

</details>


<hr>

#### collectVarData()

```php
protected function collectVarData() : array
```

<details>
<summary style="margin-bottom:12px;"><strong>Description</strong></summary>

<table>
<tr><td>
Returns an array of data from all of the modules
that should be displayed in the 'Vars' tab.
</td></tr>
</table>


</details>



<table style="text-align:left">
</table>





<table>
<tr>
<th style="vertical-align:top;">return</th>
<td>array
</td>
</tr>
</table>





<details>
<summary><small>Source: 16 lines (291 - 306)</small></summary>

```php
protected function collectVarData(): array
{
	$data = [];

	foreach ($this->collectors as $collector)
	{
		if (! $collector->hasVarData())
		{
			continue;
		}

		$data = array_merge($data, $collector->getVarData());
	}

	return $data;
}
```

</details>


<hr>

#### roundTo()

```php
protected function roundTo(float $number, int $increments = 5) : float
```

<details>
<summary style="margin-bottom:12px;"><strong>Description</strong></summary>

<table>
<tr><td>
Rounds a number to the nearest incremental value.
</td></tr>
</table>


</details>



<table style="text-align:left">
</table>


**Params**

<table>
<thead>
<tr>
<th>#</th>
<th>Variable</th>
<th>Type</th>
<th>Variadic</th>
<th>Description</th>
</tr>
</thead>
<tbody>

<tr>
<td>1.</td>
<td><code>$number</code></td>
<td><em>float
</em></td>
<td>false</td>
<td></td>
</tr>

<tr>
<td>2.</td>
<td><code>$increments</code></td>
<td><em>int
</em></td>
<td>false</td>
<td></td>
</tr>


</tbody>
</table>



<table>
<tr>
<th style="vertical-align:top;">return</th>
<td>float
</td>
</tr>
</table>





<details>
<summary><small>Source: 6 lines (318 - 323)</small></summary>

```php
protected function roundTo(float $number, int $increments = 5): float
{
	$increments = 1 / $increments;

	return (ceil($number * $increments) / $increments);
}
```

</details>


<hr>

#### prepare()

```php
public function prepare(RequestInterface $request = null, ResponseInterface $response = null)
```

<details>
<summary style="margin-bottom:12px;"><strong>Description</strong></summary>

<table>
<tr><td>
Prepare for debugging.
</td></tr>
</table>

<table>
<tr><td>
.
</td></tr>
</table>

</details>



<table style="text-align:left">
<tr style="vertical-align:top;">
<th>global</th>
<td>type $app
</td>
</tr>
</table>


**Params**

<table>
<thead>
<tr>
<th>#</th>
<th>Variable</th>
<th>Type</th>
<th>Variadic</th>
<th>Description</th>
</tr>
</thead>
<tbody>

<tr>
<td>1.</td>
<td><code>$request</code></td>
<td><em>\RequestInterface
</em></td>
<td>false</td>
<td></td>
</tr>

<tr>
<td>2.</td>
<td><code>$response</code></td>
<td><em>\ResponseInterface
</em></td>
<td>false</td>
<td></td>
</tr>


</tbody>
</table>



<table>
<tr>
<th style="vertical-align:top;">return</th>
<td>\type
</td>
</tr>
</table>





<details>
<summary><small>Source: 70 lines (335 - 404)</small></summary>

```php
public function prepare(RequestInterface $request = null, ResponseInterface $response = null)
{
	if (CI_DEBUG && ! is_cli())
	{
		global $app;

		$request  = $request ?? Services::request();
		$response = $response ?? Services::response();

		// Disable the toolbar for downloads
		if ($response instanceof DownloadResponse)
		{
			return;
		}

		$toolbar = Services::toolbar(config(Toolbar::class));
		$stats   = $app->getPerformanceStats();
		$data    = $toolbar->run(
				$stats['startTime'],
				$stats['totalTime'],
				$request,
				$response
		);

		helper('filesystem');

		// Updated to time() so we can get history
		$time = time();

		if (! is_dir(WRITEPATH . 'debugbar'))
		{
			mkdir(WRITEPATH . 'debugbar', 0777);
		}

		write_file(WRITEPATH . 'debugbar/' . 'debugbar_' . $time . '.json', $data, 'w+');

		$format = $response->getHeaderLine('content-type');

		// Non-HTML formats should not include the debugbar
		// then we send headers saying where to find the debug data
		// for this response
		if ($request->isAJAX() || strpos($format, 'html') === false)
		{
			$response->setHeader('Debugbar-Time', "$time")
					->setHeader('Debugbar-Link', site_url("?debugbar_time={$time}"))
					->getBody();

			return;
		}

		$script = PHP_EOL
				. '<script type="text/javascript" {csp-script-nonce} id="debugbar_loader" '
				. 'data-time="' . $time . '" '
				. 'src="' . site_url() . '?debugbar"></script>'
				. '<script type="text/javascript" {csp-script-nonce} id="debugbar_dynamic_script"></script>'
				. '<style type="text/css" {csp-style-nonce} id="debugbar_dynamic_style"></style>'
				. PHP_EOL;

		if (strpos($response->getBody(), '<head>') !== false)
		{
			$response->setBody(
					str_replace('<head>', '<head>' . $script, $response->getBody())
			);

			return;
		}

		$response->appendBody($script);
	}
}
```

</details>


<hr>

#### respond()

```php
public function respond()
```

<details>
<summary style="margin-bottom:12px;"><strong>Description</strong></summary>

<table>
<tr><td>
Inject debug toolbar into the response.
</td></tr>
</table>


</details>



<table style="text-align:left">
</table>










<details>
<summary><small>Source: 54 lines (411 - 464)</small></summary>

```php
public function respond()
{
	if (ENVIRONMENT === 'testing')
	{
		return;
	}

	// @codeCoverageIgnoreStart
	$request = Services::request();

	// If the request contains '?debugbar then we're
	// simply returning the loading script
	if ($request->getGet('debugbar') !== null)
	{
		// Let the browser know that we are sending javascript
		header('Content-Type: application/javascript');

		ob_start();
		include($this->config->viewsPath . 'toolbarloader.js.php');
		$output = ob_get_clean();

		exit($output);
	}

	// Otherwise, if it includes ?debugbar_time, then
	// we should return the entire debugbar.
	if ($request->getGet('debugbar_time'))
	{
		helper('security');

		// Negotiate the content-type to format the output
		$format = $request->negotiate('media', [
			'text/html',
			'application/json',
			'application/xml',
		]);
		$format = explode('/', $format)[1];

		$file     = sanitize_filename('debugbar_' . $request->getGet('debugbar_time'));
		$filename = WRITEPATH . 'debugbar/' . $file . '.json';

		// Show the toolbar
		if (is_file($filename))
		{
			$contents = $this->format(file_get_contents($filename), $format);
			exit($contents);
		}

		// File was not written or do not exists
		http_response_code(404);
		exit; // Exit here is needed to avoid load the index page
	}
	// @codeCoverageIgnoreEnd
}
```

</details>


<hr>

#### format()

```php
protected function format(string $data, string $format = 'html') : string
```

<details>
<summary style="margin-bottom:12px;"><strong>Description</strong></summary>

<table>
<tr><td>
Format output
</td></tr>
</table>


</details>



<table style="text-align:left">
</table>


**Params**

<table>
<thead>
<tr>
<th>#</th>
<th>Variable</th>
<th>Type</th>
<th>Variadic</th>
<th>Description</th>
</tr>
</thead>
<tbody>

<tr>
<td>1.</td>
<td><code>$data</code></td>
<td><em>string
</em></td>
<td>false</td>
<td>JSON encoded Toolbar data</td>
</tr>

<tr>
<td>2.</td>
<td><code>$format</code></td>
<td><em>string
</em></td>
<td>false</td>
<td>html, json, xml</td>
</tr>


</tbody>
</table>



<table>
<tr>
<th style="vertical-align:top;">return</th>
<td>string
</td>
</tr>
</table>





<details>
<summary><small>Source: 39 lines (474 - 512)</small></summary>

```php
protected function format(string $data, string $format = 'html'): string
{
	$data = json_decode($data, true);

	if ($this->config->maxHistory !== 0)
	{
		$history = new History();
		$history->setFiles(
				Services::request()->getGet('debugbar_time'),
				$this->config->maxHistory
		);

		$data['collectors'][] = $history->getAsArray();
	}

	$output = '';

	switch ($format)
	{
		case 'html':
			$data['styles'] = [];
			extract($data);
			$parser = Services::parser($this->config->viewsPath, null, false);
			ob_start();
			include($this->config->viewsPath . 'toolbar.tpl.php');
			$output = ob_get_clean();
			break;
		case 'json':
			$formatter = new JSONFormatter();
			$output    = $formatter->format($data);
			break;
		case 'xml':
			$formatter = new XMLFormatter;
			$output    = $formatter->format($data);
			break;
	}

	return $output;
}
```

</details>





 


 
  




<hr>

<table>
<tr>
<td style="width:100%"><em>framework/system/Debug/Toolbar.php</em></td>
<td><a href="../../../../../../api/index.md">index</a></td>
<td><a href="../../../../../../api/vendor/codeigniter4/framework/system/Debug/Timer.md">prev</a></td>
<td><a href="../../../../../../api/vendor/codeigniter4/framework/system/Debug/Toolbar/Collectors/BaseCollector.md">next</a></td>
<td><a href="#">top</a></td></tr>
</table>




<div style="text-align:right;">

<small>_Generated at **2020-08-14 07:35:11**_ *([EnixApp](https://github.com/enix-app) - [ApiDoc](https://github.com/enix-app/apidoc))*</small>
</div>